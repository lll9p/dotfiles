#!/usr/bin/env bash

set -eufo pipefail

DISTRO=$(grep -E '^(ID|ID_LIKE)=' /etc/os-release | cut -d= -f2 | tr -d '"')

case "$DISTRO" in
*arch*) ;;
*)
  exit 0
  ;;
esac

##########################################

echo 'UPDATING SOURCES...'
sudo pacman -Sy

{{ $pkgs := .pkgs.archBased.universal }}

{{ if $pkgs }}
echo 'INSTALLING PACKAGES...'
PKGS=({{ $pkgs | quoteList | join " " }})
PRESENT_PKGS=()
for pkg in "${PKGS[@]}"; do
  if pacman -Si "$pkg" &>/dev/null; then
    PRESENT_PKGS+=("$pkg")
  else
    echo "Warning: Package '$pkg' not found in repositories. Skipping..."
  fi
done

if [ ${#PRESENT_PKGS[@]} -gt 0 ]; then
  sudo pacman -S "${PRESENT_PKGS[@]}" --needed --noconfirm
fi
{{ end }}

##########################################

echo 'SETTING UP SERVICES...'
